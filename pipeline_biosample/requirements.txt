# pipeline_biosample/requirements.txt

## 역할
- DDBJ comment, XSD 검증 과정에서 식별된 에러 해결법, 자동 수정 요소, 예외처리, 기타 참고사항을 기록한다.
- 파이프라인 구현 시 이 파일을 참조하여 자동 수정 및 예외처리 로직을 설계하고, 신규 이슈 발생 시 반드시 갱신한다.

## 주요 에러 및 해결법 (2025-05-23 기준)

### 1. 제출본(xml_submitted/ddbj_biosample.xml) XSD 검증 결과
- 루트 태그명 <SAMPLE_SET> → <BioSampleSet>으로 변경 필요
- 내부 반복 요소 <SAMPLE> → <BioSample>로 모두 변경 필요
- 내부 구조/필드명/위치 등도 실제 예시와 일치시켜야 함
- real_examples/difference.sample.txt에 정리된 차이점(루트/필드명/구조/필수값 등)을 반드시 반영

### 2. 실제 예시(real_examples/SAMD00844971-2.xml) XSD 검증 결과
- 정상 통과 (validates)
- <BioSampleSet> 루트, <BioSample> 반복, 내부 구조, 필드명, 위치, 값 등 모든 것이 XSD와 일치

### 3. 결론 및 실무 적용
- 루트 태그, 내부 반복 요소, 구조/필드명/위치 모두 실제 예시와 동일하게 맞춰야 XSD 검증 통과

# 파이프라인 구현 시 반드시 이 파일을 참조할 것

- BioSample 태그에는 오직 access 속성만 허용, 값은 "public"으로 고정
- accession, alias, center_name 속성은 제거
- <IDENTIFIERS> 태그는 <Ids>로 변환
- <Ids> 내부 구조는 실제 DDBJ 예시와 동일하게 맞춤

# [2024-06-XX] XSD 검증 정책 추가
# - SAMPLE_NAME 태그는 BioSample에서 반드시 제거한다.
# - SAMPLE_NAME 내부의 TAXON_ID, SCIENTIFIC_NAME 값은 SAMPLE_ATTRIBUTES의 SAMPLE_ATTRIBUTE로 각각 이동한다.
#   예시: <SAMPLE_ATTRIBUTE><TAG>TAXON_ID</TAG><VALUE>10116</VALUE></SAMPLE_ATTRIBUTE>
#         <SAMPLE_ATTRIBUTE><TAG>SCIENTIFIC_NAME</TAG><VALUE>Rattus norvegicus</VALUE></SAMPLE_ATTRIBUTE>
# - BioSample 내에는 반드시 <Ids> 태그가 존재해야 하며, SAMPLE_NAME보다 먼저 위치해야 한다(실제 예시 기준). 그러나 SAMPLE_NAME은 제거하므로 <Ids>만 남는다.
# - 위 정책을 어기면 XSD 검증에서 오류가 발생한다.
# - BioSample 내에서 <Ids> 태그가 반드시 첫 번째, <SAMPLE_ATTRIBUTES>가 두 번째로 위치해야 한다.
#   (예시: <BioSample><Ids>...</Ids><SAMPLE_ATTRIBUTES>...</SAMPLE_ATTRIBUTES>...)
# - 순서가 어긋나면 XSD 검증에서 오류가 발생한다.

# - <PRIMARY_ID> 태그는 반드시 <Id>로 변환한다. (예시: <Ids><Id label="BioSample ID">KAS24087646</Id></Ids>)
# - <Description> 태그는 <Ids> 다음에 반드시 존재해야 하며, 없으면 빈 값으로라도 추가한다.
# - <SAMPLE_ATTRIBUTES>는 <Description> 다음에 위치해야 한다.
# - 순서: <Ids> → <Description> → <SAMPLE_ATTRIBUTES> → 나머지
# - 위 정책을 어기면 XSD 검증에서 오류가 발생한다.

# - <Id> 태그에는 label 속성을 절대 추가하지 않는다.
# - <Id> 태그에는 반드시 namespace="BioSample" 속성을 추가한다.
# - <Description> 태그는 반드시 하위에 <SampleName>, <Synonym>, <Title> 중 하나 이상을 포함해야 하며, 빈 Description은 허용되지 않는다.
# - <Owner> 태그가 반드시 <SAMPLE_ATTRIBUTES> 앞에 위치해야 하며, 없으면 기본값으로 추가한다.
# - 순서: Ids → Description → Owner → SAMPLE_ATTRIBUTES → 나머지
# - 위 정책을 어기면 XSD 검증에서 오류가 발생한다.

# - <Description> 태그 하위에는 반드시 <Organism> 태그를 포함해야 한다. Organism 정보는 TAXON_ID, SCIENTIFIC_NAME, SAMPLE_ATTRIBUTES 등에서 추출한다.
# - <Attributes> 태그명은 XSD에서 허용하는 명칭(예: <SAMPLE_ATTRIBUTES> 또는 <Attributes>)만 사용한다. 실제 예시와 XSD 스키마를 반드시 참고할 것.

# - <Description> 하위 <Organism> 태그에는 반드시 <OrganismName>만 허용한다. <TaxonId> 등은 절대 포함하지 않는다.
# - Organism 정보는 SCIENTIFIC_NAME → OrganismName으로만 매핑한다. TAXON_ID는 SAMPLE_ATTRIBUTE로만 유지한다.
# - <SAMPLE_ATTRIBUTES> 태그는 반드시 <Attributes>로 변환한다. 내부 구조도 실제 예시와 동일하게 맞춘다.

# - <Attributes> 태그는 반드시 <Models> 다음에만 위치해야 한다.
# - <Models> 태그가 없고 <Attributes>가 필요한 경우, <Models>를 빈 값으로 추가한 뒤 <Attributes>를 추가한다.
# - <Owner> 또는 <Providers> 다음에 <Attributes>가 오면 XSD에서 허용되지 않는다.
# - 순서: Ids → Description → Owner → Providers(optional) → Models(필수) → Attributes(optional) → ...
# - <Attributes> 태그는 <Models> 다음에만 위치해야 한다.
# - <Models> 태그가 없고 <Attributes>가 필요한 경우, <Models>를 빈 값으로 추가한 뒤 <Attributes>를 추가한다.
# - <Owner> 또는 <Providers> 다음에 <Attributes>가 오면 XSD에서 허용되지 않는다.
# - 순서: Ids → Description → Owner → Providers(optional) → Models(필수) → Attributes(optional) → ...
# - <SAMPLE_ATTRIBUTES>, <SAMPLE_ATTRIBUTE> 태그는 절대 사용하지 않는다. (실제 예시 및 XSD와 반드시 일치)
# - BioSample 내부 태그 순서: Ids → Description → Owner → Providers(optional) → Models → Attributes → Links(optional) → Relations(optional)
# - 반복 허용 태그: <BioSampleSet> 내 <BioSample>, <Attributes> 내 <Attribute>, <Models> 내 <Model>, <Description> 내 <Synonym>/<Organism>, <Owner> 내 <Name>, <Contacts> 내 <Contact>
# - 반복 태그는 항상 리스트로 처리해야 하며, 단일일 때도 리스트로 변환
# - 태그명/위치/구조는 반드시 실제 예시와 XSD를 모두 만족해야 함
# [2024-06-XX] BioSample 자동 변환 파이프라인 XSD PASS 정책 유지/보완

# - <Models> 태그는 반드시 존재해야 하며, 최소 1개 이상의 <Model> 자식 태그가 있어야 한다.
# - <Models>가 없거나 비어 있으면 <Model>unknown</Model>을 추가한다.
# - <Attributes>는 <Models> 다음에만 위치한다.
